<!doctype html>
<html lang="en" data-theme="auto">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#ffffff"  media="(prefers-color-scheme: light)">

    <title>MindMatch 4 — Adaptive Connect Four | Smart Mind Game</title>
    <meta name="description" content="MindMatch 4 is an adaptive Connect Four game. The AI learns your style and gets harder as you win. Play vs AI or local multiplayer." />
    <link rel="canonical" href="https://ravi-chandu.github.io/MindMatch4/" />

    <!-- Social -->
    <meta property="og:title" content="MindMatch 4 — Adaptive Connect Four" />
    <meta property="og:description" content="Beat the AI… if you can. It learns your strategy and ramps up." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://ravi-chandu.github.io/MindMatch4/" />
    <meta property="og:image" content="https://ravi-chandu.github.io/MindMatch4/og-cover.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="https://ravi-chandu.github.io/MindMatch4/og-cover.png" />

    <!-- Icons resolve under /MindMatch4/ -->
    <link rel="icon" href="%BASE_URL%favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32"  href="%BASE_URL%logo-32.png" />
    <link rel="icon" type="image/png" sizes="64x64"  href="%BASE_URL%logo-64.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="%BASE_URL%logo-192.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="%BASE_URL%logo-512.png" />
    <link rel="manifest" href="/MindMatch4/manifest.json" />

    <style>
      :root{
        --bg:#ffffff; --bg2:#f3f4f6; --ink:#111827; --muted:#6b7280;
        --panel:rgba(255,255,255,.92); --panel-border:rgba(0,0,0,.08);
        --hole:#e5e7eb; --grid:#1f2937;
        --red:#ef4444; --yellow:#fbbf24; --green:#16a34a; --blue:#3b82f6; --violet:#7c3aed;
        --shadow:0 10px 30px rgba(0,0,0,.12);
        --cell:56px; --gap:10px;  /* updated by fitCell() */
      }
      @media (prefers-color-scheme: dark){
        :root{
          --bg:#0b1222; --bg2:#0f172a; --ink:#e5e7eb; --muted:#94a3b8;
          --panel:rgba(17,24,39,.85); --panel-border:rgba(255,255,255,.08);
          --hole:#0f172a; --grid:#1f2937;
          --shadow:0 14px 36px rgba(0,0,0,.42);
        }
      }
      [data-theme="light"]{
        --bg:#ffffff; --bg2:#f3f4f6; --ink:#111827; --muted:#6b7280;
        --panel:rgba(255,255,255,.92); --panel-border:rgba(0,0,0,.08);
        --hole:#e5e7eb; --grid:#d1d5db;
      }
      [data-theme="dark"]{
        --bg:#0b1222; --bg2:#0f172a; --ink:#e5e7eb; --muted:#94a3b8;
        --panel:rgba(17,24,39,.85); --panel-border:rgba(255,255,255,.08);
        --hole:#0f172a; --grid:#1f2937;
      }

      /* Prevent stray overflow causing bottom scroller */
      *, *::before, *::after { box-sizing: border-box; }
      html, body { overflow-x: hidden; }
      html,body,#root{height:100%}

      body{
        margin:0;
        background:linear-gradient(180deg,var(--bg2),var(--bg));
        color:var(--ink);
        font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial,"Noto Sans";
        overflow-y:auto;
      }

      /* Header with centered title */
      .site-header{
        position:sticky; top:0; z-index:50;
        display:grid; grid-template-columns:1fr auto 1fr; align-items:center;
        gap:8px; padding:8px;
        background:var(--panel); border-bottom:1px solid var(--panel-border);
        -webkit-backdrop-filter:saturate(140%) blur(6px); backdrop-filter:saturate(140%) blur(6px);
      }
      .site-title{ text-align:center; font-weight:700; letter-spacing:.4px; cursor:pointer }
      .theme-toggle{ justify-self:end; display:flex; gap:6px; align-items:center }
      .tiny{ font-size:.9rem; color:var(--muted) }

      .mm4-shell{ display:flex; justify-content:center; padding:12px; width:100%; }

      .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

      /* Card/Buttons */
      .card{ background: var(--panel); border:1px solid var(--panel-border); border-radius:12px; padding:14px; box-shadow: var(--shadow); }
      .big-options{ display:grid; gap:12px; margin: 10px 0; }
      .big-btn{ padding:16px; border-radius:14px; border:1px solid var(--grid); background:var(--bg2); color:var(--ink); cursor:pointer; font-size:1.05rem; font-weight:600; }
      .big-btn.ai{    border-color: var(--blue) }
      .big-btn.p2{    border-color: var(--green) }
      .big-btn.daily{ border-color: var(--violet) }

      /* Toolbar above the board (Home/Reset/Hint) */
      .modebar{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin:8px 0 10px; }
      .modebar button{ padding:8px 12px; border-radius:10px; border:1px solid var(--grid); background:var(--bg2); color:var(--ink); cursor:pointer }

      /* Board container – CENTERED */
      .board-wrap{ position:relative; margin: 0 auto; }
      .board{
        display:grid;
        grid-template-columns:repeat(7, var(--cell));
        gap:var(--gap);
        padding:8px;
        background:var(--panel);
        border:1px solid var(--panel-border);
        border-radius:14px;
        box-shadow:var(--shadow);
        width:calc(7 * var(--cell) + 6 * var(--gap));
        margin:0 auto; /* center grid */
      }
      .col{ display:grid; grid-template-rows:repeat(6, var(--cell)); gap:var(--gap); cursor:pointer; }
      .cell{
        width:var(--cell); height:var(--cell); border-radius:14px;
        background: radial-gradient(circle at 30% 30%, var(--hole), var(--grid));
        display:flex; align-items:center; justify-content:center; position:relative;
      }
      .disc{ width:calc(var(--cell) - 8px); height:calc(var(--cell) - 8px); border-radius:999px; box-shadow: inset 0 4px 10px rgba(0,0,0,.25), 0 2px 6px rgba(0,0,0,.2); }
      .disc.yellow{ background: radial-gradient(circle at 32% 28%, #ffe9a8, #fbbf24); border: 2px solid #d1a200; }
      .disc.red{    background: radial-gradient(circle at 32% 28%, #ff8a8a, #ef4444); border: 2px solid #b91c1c; }

      /* Winner overlay line */
      .win-overlay{ pointer-events:none; position:absolute; inset:8px; z-index:5; }
      .win-overlay svg{ width:100%; height:100%; }

      /* Result modal */
      .modal{ position: fixed; inset: 0; z-index: 70; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,.35); }
      .dialog{ background: var(--panel); border: 1px solid var(--panel-border); border-radius: 14px; padding: 16px; width: min(92vw, 420px); color: var(--ink); box-shadow: var(--shadow); }
      .dialog h2{ margin: 0 0 8px; }
      .dialog .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; justify-content:center }
      .dialog button{ padding:8px 12px; border-radius:10px; border:1px solid var(--grid); background:var(--bg2); color:var(--ink); cursor:pointer }

      /* Stats under board */
      .stats{ margin: 10px auto; text-align:center; color: var(--muted) }

      #mm4-confetti{position:fixed;inset:0;pointer-events:none;z-index:60}
      .hint-col { outline: 3px solid var(--green); outline-offset: 2px; }
      @keyframes mm4Pulse { 0%{box-shadow:0 0 0 0 rgba(59,130,246,.45)} 70%{box-shadow:0 0 0 18px rgba(59,130,246,0)} 100%{box-shadow:0 0 0 0 rgba(59,130,246,0)} }
      .onboard-pulse { outline: 3px solid #3b82f6; outline-offset: 2px; animation: mm4Pulse 1.2s ease-out 2; border-radius:12px; }
    </style>

    <!-- JSON-LD -->
    <script type="application/ld+json">
    {
      "@context":"https://schema.org",
      "@type":["Game","VideoGame"],
      "name":"MindMatch 4 — Adaptive Connect Four",
      "url":"https://ravi-chandu.github.io/MindMatch4/",
      "applicationCategory":"Game",
      "operatingSystem":"Web",
      "inLanguage":"en",
      "gamePlatform":"Web",
      "genre":["Strategy","Board game","Puzzle"],
      "description":"Smart, adaptive Connect Four with explainable hints, skill-based AI, and offline play.",
      "author":{"@type":"Person","name":"Ravi Chandu"},
      "publisher":{"@type":"Person","name":"Ravi Chandu"},
      "offers":{"@type":"Offer","price":"0","priceCurrency":"USD","category":"free","availability":"https://schema.org/InStock"},
      "aggregateRating":{"@type":"AggregateRating","ratingValue":"4.8","reviewCount":"57"}
    }
    </script>

    <!-- PWA -->
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/MindMatch4/sw.js");
      }
    </script>

    <!-- GA4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-E18C1B9SE4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'G-E18C1B9SE4');
    </script>

    <!-- Fit 7x6 strictly inside available width/height (no side scroll) -->
    <script>
      function currentTheme(){
        const t = localStorage.getItem("mm4_theme") || "auto";
        document.documentElement.setAttribute("data-theme", t);
        const sel = document.getElementById("themeSelect");
        if (sel) sel.value = t;
      }
      currentTheme();

      function fitCell(){
        const gap = 10;         // keep in sync
        const pagePad = 24;     // left+right content padding
        const boardPad = 16;    // .board padding 8+8
        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
        const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        const headerH = (document.querySelector('.site-header')?.offsetHeight || 0);

        const availW = vw - pagePad - boardPad - 1; // -1 avoids rounding spill
        const availH = vh - headerH - 220;          // headroom

        const cellFromW = Math.floor((availW - gap*6) / 7);
        const cellFromH = Math.floor((availH - gap*5) / 6);
        const size = Math.max(26, Math.min(92, Math.min(cellFromW, cellFromH)));

        /* IMPORTANT: include px units for both custom props */
        document.documentElement.style.setProperty('--gap',  gap + 'px');
        document.documentElement.style.setProperty('--cell', size + 'px');
      }

      addEventListener('resize', fitCell);
      addEventListener('orientationchange', fitCell);
      addEventListener('DOMContentLoaded', fitCell);
    </script>
  </head>

  <body>
    <header class="site-header">
      <div class="tiny">🧠</div>
      <h1 class="site-title">MindMatch 4</h1>
      <div class="theme-toggle">
        <label class="tiny" for="themeSelect" style="margin-right:6px">Theme</label>
        <select id="themeSelect" aria-label="Theme">
          <option value="auto">Default</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </div>
    </header>

    <div id="root" class="mm4-shell"></div>
    <canvas id="mm4-confetti"></canvas>
    <span id="announce" aria-live="polite" class="sr-only"></span>

    <!-- Vite entry -->
    <script type="module" src="/src/main.jsx"></script>

    <!-- Boot + AI wiring (eager so Hint works immediately) -->
    <script type="module">
      // Title → Home
      document.querySelector(".site-title")?.addEventListener("click", ()=>{
        window.dispatchEvent(new CustomEvent("mm4:navigate",{detail:{to:"home"}}));
      });

      // Theme persistence
      const setT = (t)=>{ localStorage.setItem("mm4_theme", t); document.documentElement.setAttribute("data-theme", t); };
      document.getElementById("themeSelect")?.addEventListener("change", (e)=> setT(e.target.value));

      // Import AI adapters immediately so Hint/Daily listeners are active
      import "./ai/adapter.js";
      import "./ai/mm4-plugin.js";
      import "./ai/mm4-plugin-wire.js";

      // Analytics hooks
      window.addEventListener("mm4:hint",   (e)=> window.gtag && gtag('event','hint_used',{count:e.detail?.best?.length||0}));
      window.addEventListener("mm4:aimove", (e)=> window.gtag && gtag('event','ai_move',{col:e.detail?.col}));
      window.addEventListener("mm4:gameend",(e)=> window.gtag && gtag('event','game_end',{outcome:e.detail?.outcome}));
    </script>
  </body>
</html>
