<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#ffffff"  media="(prefers-color-scheme: light)">

    <title>MindMatch 4 — Adaptive Connect Four | Smart Mind Game</title>
    <meta name="description" content="MindMatch 4 is an adaptive Connect Four game. The AI learns your style and gets harder as you win. Play vs AI or local multiplayer." />
    <link rel="canonical" href="https://ravi-chandu.github.io/MindMatch4/" />

    <!-- OG/Twitter -->
    <meta property="og:title" content="MindMatch 4 — Adaptive Connect Four" />
    <meta property="og:description" content="Beat the AI… if you can. It learns your strategy and ramps up." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://ravi-chandu.github.io/MindMatch4/" />
    <meta property="og:image" content="https://ravi-chandu.github.io/MindMatch4/og-cover.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="https://ravi-chandu.github.io/MindMatch4/og-cover.png" />

    <!-- Icons resolve under /MindMatch4/ -->
    <link rel="icon" href="%BASE_URL%favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32"  href="%BASE_URL%logo-32.png" />
    <link rel="icon" type="image/png" sizes="64x64"  href="%BASE_URL%logo-64.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="%BASE_URL%logo-192.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="%BASE_URL%logo-512.png" />
    <link rel="manifest" href="/MindMatch4/manifest.json" />

    <style>
      :root{
        --bg:#ffffff; --bg2:#f3f4f6; --ink:#111827; --muted:#6b7280;
        --panel:rgba(255,255,255,.92); --panel-border:rgba(0,0,0,.08);
        --hole:#e5e7eb; --grid:#d1d5db;
        --red:#ef4444; --yellow:#fbbf24; --green:#16a34a;
        --shadow:0 10px 30px rgba(0,0,0,.12);
        --cell: 56px;                      /* auto-updated by JS below */
        --gap: 10px;
      }
      @media (prefers-color-scheme: dark){
        :root{
          --bg:#0b1222; --bg2:#0f172a; --ink:#e5e7eb; --muted:#94a3b8;
          --panel:rgba(17,24,39,.85); --panel-border:rgba(255,255,255,.08);
          --hole:#0f172a; --grid:#1f2937;
          --shadow:0 14px 36px rgba(0,0,0,.42);
        }
      }
      html,body,#root{height:100%}
      body{
        margin:0;
        background:linear-gradient(180deg,var(--bg2),var(--bg));
        color:var(--ink);
        font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial,"Noto Sans";
        overflow:auto; /* allow scroll when needed */
      }

      /* Top bar with Hint/Daily stays in-frame (no overlap with board) */
      .top-toolbar{
        position:sticky; top:0; z-index:50;
        display:flex; gap:8px; align-items:center; justify-content:center;
        padding:8px; background:var(--panel); border-bottom:1px solid var(--panel-border);
        -webkit-backdrop-filter:saturate(140%) blur(6px); backdrop-filter:saturate(140%) blur(6px);
      }
      .top-toolbar button{
        padding:8px 12px; border-radius:10px; border:1px solid var(--grid);
        background:var(--bg2); color:var(--ink); cursor:pointer
      }
      .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
      .hint-col { outline: 3px solid var(--green); outline-offset: 2px; }

      /* Shell centers everything and enables horizontal scroll ONLY if needed */
      .mm4-shell{ display:flex; align-items:center; justify-content:center; padding:10px 12px 24px; width:100%; }
      .mm4-shell.scroll-x{ overflow-x:auto; }

      /* Confetti layer */
      #mm4-confetti{position:fixed;inset:0;pointer-events:none;z-index:60}
    </style>

    <!-- JSON-LD -->
    <script type="application/ld+json">
    {"@context":"https://schema.org","@type":["Game","VideoGame"],"name":"MindMatch 4 — Adaptive Connect Four","url":"https://ravi-chandu.github.io/MindMatch4/","applicationCategory":"Game","operatingSystem":"Web","inLanguage":"en","gamePlatform":"Web","genre":["Strategy","Board game","Puzzle"],"description":"Smart, adaptive Connect Four with explainable hints, skill-based AI, and offline play.","author":{"@type":"Person","name":"Ravi Chandu"},"publisher":{"@type":"Person","name":"Ravi Chandu"}}
    </script>

    <!-- PWA -->
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/MindMatch4/sw.js");
      }
    </script>

    <!-- GA4 (your ID) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-E18C1B9SE4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'G-E18C1B9SE4');
    </script>

    <!-- Precise responsive cell sizing: fit 7x6; scroll-x only if absolutely necessary -->
    <script>
      function fitCell(){
        const shell = document.querySelector('.mm4-shell');
        const toolbarH = (document.querySelector('.top-toolbar')?.offsetHeight||0);
        const gap = 10; // keep in sync with --gap
        const shellW = shell ? shell.getBoundingClientRect().width : window.innerWidth;
        const availW = shellW - 24 - 16;     // shell pads (12+12) & board pads (8+8)
        const availH = window.innerHeight - toolbarH - 180; // leave for headers/status

        const cellFromW = Math.floor((availW - gap*6) / 7);
        const cellFromH = Math.floor((availH - gap*5) / 6);
        const size = Math.max(28, Math.min(96, Math.min(cellFromW, cellFromH)));
        document.documentElement.style.setProperty('--gap', gap + 'px');
        document.documentElement.style.setProperty('--cell', size + 'px');

        // Decide if horizontal scroll is still needed:
        const boardOuterW = (7*size + 6*gap) + 16; // + board padding
        const needsX = boardOuterW > (shellW + 1);
        shell?.classList.toggle('scroll-x', needsX);
      }
      addEventListener('resize', fitCell);
      addEventListener('orientationchange', fitCell);
      addEventListener('DOMContentLoaded', fitCell);
    </script>
  </head>

  <body>
    <!-- Controls always visible -->
    <div class="top-toolbar">
      <button id="btnHome">Home</button>
      <button id="btnInstructions">Instructions</button>
      <button id="btnStats">Stats</button>
      <span style="flex:1"></span>
      <button id="btnHint" aria-label="Show hint">Hint</button>
      <button id="btnDaily">Daily Puzzle</button>
      <span id="announce" aria-live="polite" class="sr-only"></span>
    </div>

    <div id="root" class="mm4-shell"></div>
    <canvas id="mm4-confetti"></canvas>

    <!-- Vite dev entry (rewritten to hashed assets on build) -->
    <script type="module" src="/src/main.jsx"></script>

    <!-- AI wiring -->
    <script type="module">
      import "./ai/adapter.js";
      import "./ai/mm4-plugin.js";
      import "./ai/mm4-plugin-wire.js";

      // Analytics events
      window.addEventListener("mm4:hint",   (e)=> window.gtag && gtag('event','hint_used',{count:e.detail?.best?.length||0}));
      window.addEventListener("mm4:daily",  ()=> window.gtag && gtag('event','daily_loaded'));
      window.addEventListener("mm4:aimove", (e)=> window.gtag && gtag('event','ai_move',{col:e.detail?.col}));
      window.addEventListener("mm4:gameend",(e)=> window.gtag && gtag('event','game_end',{outcome:e.detail?.outcome}));
      // simple client-side nav
      const nav = (id, to) => document.getElementById(id)?.addEventListener('click', () => window.dispatchEvent(new CustomEvent('mm4:navigate',{detail:{to}})));
      nav('btnHome','home'); nav('btnInstructions','instructions'); nav('btnStats','stats');
    </script>
  </body>
</html>
